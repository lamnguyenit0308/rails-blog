<div class="post-show">
  <div class="post-info d-flex justify-content-between" style="gap: 20px;">
    <div class="d-flex" style="gap: 20px;">
      <p><strong>Created at:</strong> <%= @post.created_at.strftime("%d/%m/%Y") %></p>
      <p><strong>Creator:</strong> <%= @post.user.email %></p>
    </div>
    <div class="post-action">
      <a href="<%= edit_post_path(@post) %>" class="btn btn-outline-secondary btn-sm">Edit</a>
      <%= link_to "Delete", post_path(@post), method: :delete, data: {
        turbo_method: :delete,
        turbo_confirm: "Are you sure delete this post?"
      }, class: "btn btn-outline-danger btn-sm" %>
    </div>
  </div>
  <div class="title">
    <h1>
      <%= @post.title %>
    </h1>
  </div>
  <div class="content">
    <%= raw @post.content %>
  </div>
</div>

<h2 class="mt-5">Comments</h2>
<% if user_signed_in? %>
  <%= form_with model: [ @post, @post.comments.build ] do |form| %>
    <p>
      <%= form.text_area :content, class: "form-control" %>
    </p>
    <p>
      <%= form.submit "Post comment", class: "btn btn-outline-warning" %>
    </p>
  <% end %>
<% else %>
    <div class="card">
      <div class="card-body text-center">
        <i class="bi bi-chat-right-text-fill"></i>
        <%= link_to " Please sign in to comment", new_user_session_url, class: 'btn btn-link outline-none' %>
      </div>
    </div>
<% end %>


<% @comments.each do |comment| %>
  <div class="comment card mt-3">
    <div class="card-body">
      <div class="d-flex justify-content-between">
        <div class="d-flex head">
          <div class="avatar">
            <img src="https://cdn.tuoitre.vn/zoom/700_525/2019/5/8/avatar-publicitystill-h2019-1557284559744252594756-crop-15572850428231644565436.jpg" width="100%" height="100%">
          </div>
          <div class="comment-info">
            <p class="card-text mb-0"><strong class="text-muted"><%= comment.user.email %></strong></p>
            <p><%= comment.created_at.strftime("%A, %d/%m/%Y %H:%M:%S") %></p>
          </div>
        </div>
        <div>
          <%= button_to "Delete", post_comment_path(@post, comment), method: :delete, class: "btn btn-danger" if user_signed_in? && comment.user_id === current_user.id %>
        </div>
      </div>
      <p class="card-text"><%= comment.content %></p>
      <% if comment.replies.size > 0 %>
        <a class="btn btn-link p-0" data-bs-toggle="collapse" href="#show-reply-comment-<%= comment.id %>" role="button" aria-expanded="false" aria-controls="collapseExample">
          Show all <%= comment.replies.size %> reply
        </a>
      <% else %>
        <a class="btn btn-link p-0" data-bs-toggle="collapse" href="#show-reply-comment-<%= comment.id %>" role="button" aria-expanded="false" aria-controls="collapseExample">
          Reply
        </a>
      <% end %>
      <div class="collapse mt-3" id="show-reply-comment-<%= comment.id %>">
        <div class="card card-body">
          <% comment.replies.each do |reply| %>
            <p>
              <div class="d-flex justify-content-between">
                <div class="d-flex head">
                  <div class="avatar">
                    <img src="https://cdn.tuoitre.vn/zoom/700_525/2019/5/8/avatar-publicitystill-h2019-1557284559744252594756-crop-15572850428231644565436.jpg" width="100%" height="100%">
                  </div>
                  <div class="comment-info">
                    <p class="card-text mb-0"><strong class="text-muted"><%= reply.user.email %></strong></p>
                    <p><%= reply.created_at.strftime("%A, %d/%m/%Y %H:%M:%S") %></p>
                  </div>
                </div>
                <div class="action-comment">
                  <%= button_to "Delete", post_comment_path(@post, reply), method: :delete, class: "btn btn-danger" if user_signed_in? && comment.user_id === current_user.id %>
                </div>
              </div>
              <p class="card-text"><%= reply.content %></p>
            </p>
          <% end %>
          <% if user_signed_in? %>
            <%= form_with model: [ comment, comment.replies.build ], url: post_comment_replies_path(comment.post, comment) do |form| %>
              <p>
                <%= form.text_area :content, class: "form-control" %>
              </p>
              <p>
                <%= form.submit "Post comment", class: "btn btn-outline-warning" %>
              </p>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>
<div class="mt-3 d-flex justify-content-center">
  <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>
</div>
